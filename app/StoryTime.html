<head>
  <title>Story Time</title>
  <link href='http://fonts.googleapis.com/css?family=Open+Sans:300,400' rel='stylesheet' type='text/css'>
</head>

<body>
  <header>
    <h1 class="header">Story Time</h1>
    {{> loginButtons}}
  </header>
 

  {{#if currentUser}}
    {{#if currentEstimationTeam}}
      {{#with currentEstimationTeam}}
        {{> currentEstimation}}
      {{/with}}
    {{else}}
      {{> estimationsInProgress}}
      {{> recentEstimations}}
      {{> teams}}
    {{/if}}
  {{/if}}
</body>

<template name="currentEstimation">
  {{#with inProgressEstimation}}
    <form class="storyForm">
      <h1>
        <span>Story</span>
        {{#if result}}
          <span>{{result}}</span>
        {{else}}
          <span>?</span>
        {{/if}}
        <span> </span>
        <span>{{units}}</span>
      </h1>
      {{#with story}}
        <input required type="text" name="name" placeholder="Name" value="{{name}}"/>
        <input type="text" name="link" placeholder="Link" value="{{link}}"/>
        <input type="text" name="description" placeholder="Description" value="{{description}}"/>
      {{/with}}
      <button type="submit" class="saveStory">Save</button>
    </form>
    {{> votingWidget}}
    {{> estimationHistory}}
  {{/with}}
  {{#if allParticipantsAgreedOnLastVote}}
    <button class="finalizeEstimation">Finalize Estimation</button>
  {{/if}}
  <button class="leaveEstimation">Leave Estimation</button>
</template>

<template name="votingWidget">
  <section class="votingWidget">
    <h1>Your Vote</h1>
    <form class="votingForm">
      <input type="text" placeholder="Vote Here" name="vote" value="{{vote}}"/>
      {{#if yourCurrentVote.confirmed}}
        <button type="submit">I Changed My Mind!</button>
      {{else}}
        <button type="submit">Confirm</button>
      {{/if}}
    </form>
  </section>
</template>

<template name="estimationHistory">
  {{#if allParticipantsHaveConfirmedTheirVotes}}
    <button class="showVotes">Show Votes</button>
  {{/if}}
  <table>
    <thead>
      <tr>
        <td>Team Members</td>
        <td colspan="{{voteCount}}">Votes</td>
      </tr>
    </thead>
    <tbody>
      {{#each memberVotes}}
        <tr>
          {{#if currentVote.isParticipating}}
            <td class="is-participating">{{member.name}}</td>
          {{else}}
            <td class="is-not-participating">{{member.name}}</td>
          {{/if}}
          {{#each votes}}
            <td>{{value}}</td>
          {{/each}}
          {{#if currentVote.confirmed}}
            <td>Voted</td>
          {{else}}
            <td>-</td>
          {{/if}}
        </tr>
      {{/each}}
    </tbody>
  </table>
</template>

<template name="estimationsInProgress">
  <section class="estimationsInProgress">
    <h1>Estimations</h1>
    <h2>In Progress</h2>
    <ul>
      {{#each yourTeamsThatAreEstimating}}
        <li>
          <span>{{name}}</span>
          {{#if inProgressEstimation.story.name}}
            <span> is estimating </span>
            <span>{{inProgressEstimation.story.name}}</span>
          {{/if}}
          <button class="joinEstimation">Join</button>
        </li>
      {{/each}}
    </ul>
    <h2>Ready for New Estimation</h2>
    <ul>
      {{#each yourTeamsThatAreNotEstimating}}
        <li>
          <span>{{name}}</span>
          <button class="startNewEstimation">Start New Estimation</button>
        </li>
      {{/each}}
    </ul>
  </section>
</template>

<template name="recentEstimations">
  <section class="recentEstimations">
    <h1>Recent Estimations</h1>
  </section>
</template>

<template name="teams">
  <section class="teams">
    {{#if isAddingNewTeam}}
      <form class="addNewTeamForm">
        <h1>Add New team</h1>
        <input required type="text" name="name" placeholder="Name"/>
        <input type="text" name="description" placeholder="Description"/>
        <select required name="estimationUnits">
          <option value="Story Points">Story Points</option>
          <option value="Hours">Hours</option>
          <option value="Other">Other</option>
        </select>
        <button type="submit" class="submitNewTeamButton">Create New Team</button>
        <button class="cancelButton">Cancel</button>
      </form>
    {{else}}
      <h1>Teams</h1>
      <button class="addNewTeamButton">Add New Team</button>
      <section class="yourTeams">
        <h1>Your Teams</h1>
        <ul>
          {{#each yourTeams}}
            <li>
              <span>{{name}}</span>
              <button class="leaveTeam">Leave</button>
            </li>
          {{/each}}
        </ul>
      </section>
      <section class="otherTeams">
        <h1>Other Teams</h1>
        <ul>
          {{#each otherTeams}}
            <li>
              <span>{{name}}</span>
              <button class="joinTeam">Join</button>
            </li>
          {{/each}}
        </ul>
      </section>
    {{/if}}
  </section>
</template>